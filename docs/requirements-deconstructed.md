## **Требования**

**Таск-трекер**

1. Таск-трекер должен быть отдельным дашбордом и доступен всем сотрудникам компании UberPopug Inc.
2. Авторизация в таск-трекере должна выполняться через общий сервис авторизации UberPopug Inc (у нас там инновационная система авторизации на основе формы клюва)

        Command: Sign in
        Actor: User
        Data: Credentials
        Event: auth.signedIn
3. В таск-трекере должны быть только задачи. Проектов, скоупов и спринтов нет, потому что они не умещаются в голове попуга.
4. Новые таски может создавать кто угодно (администратор, начальник, разработчик, менеджер и любая другая роль). У задачи должны быть описание, статус (выполнена или нет) и попуг, на которого заассайнена задача.

       Command: Create task
       Actor: User
       Data: Task { description, assignFee (rand), bounty (rand) }
       Event: task.created

       Command: Assign tas
       Actor: Dispatcher (task.created, task.shuffled)
       Data:  Task, User
       Event: task.assigned
5. Менеджеры или администраторы должны иметь кнопку «заассайнить задачи», которая возьмёт все открытые задачи и рандомно заассайнит каждую на любого из сотрудников (кроме менеджера и администратора) . Не успел закрыть задачу до реассайна — сорян, делай следующую.
    
    a) Ассайнить задачу можно на кого угодно (кроме менеджера и администратора), это может быть любой существующий аккаунт из системы.
        
    b) Ассайнить задачу можно только кнопкой «заассайнить задачи»
        
    c) При нажатии кнопки «заассайнить задачи» все текущие не закрытые задачи должны быть случайным образом перетасованы между каждым аккаунтом в системе
        
    d) Мы не заморачиваемся на ограничение по нажатию на кнопку «заассайнить задачи». Её можно нажимать хоть каждую секунду.
        
    e) На одного сотрудника может выпасть любое количество новых задач, может выпасть ноль, а может и 10.
        
    f) Создать задачу не заасайненую на пользователя нельзя. Т.е. любая задача должна иметь попуга, который ее делает

        Command: Shuffle tasks
        Actor: User[role=manager,admin]
        Data:  —
        Event: task.shuffled
    
6. Каждый сотрудник должен иметь возможность видеть в отдельном месте список заассайненных на него задач + отметить задачу выполненной.

        Query: list tasks
        Data: Task { description, isCompleted, Assignee(User) { name } }
        
        Command: Complete task
        Actor: User[role=worker]
        Data: Task { id } 
        Event: task.completed**

### **Аккаунтинг: кто сколько денег заработал**

1. Аккаунтинг должен быть в отдельном дашборде и доступным только для администраторов и бухгалтеров.
    
    a) у обычных попугов доступ к аккаунтингу тоже должен быть. Но только к информации о собственных счетах (аудит лог + текущий баланс). У админов и бухгалтеров должен быть доступ к общей статистике по деньгами заработанным (количество заработанных топ-менеджментом за сегодня денег + статистика по дням).
    
        Query: list audit records
        Data: AuditRecord { User { name }, amount, description }
        
        Query: list users
        Data: User { name, balance }
        
        Query: list top management stats
        Data: TopManagementStats[] { day, amount }
    
2. Авторизация в дешборде аккаунтинга должна выполняться через общий сервис аутентификации UberPopug Inc.

        Command: Sign in
3. У каждого из сотрудников должен быть свой счёт, который показывает, сколько за сегодня он получил денег. У счёта должен быть аудитлог того, за что были списаны или начислены деньги, с подробным описанием каждой из задач.

       Query: List audit records
       Data: AuditRecord { User { name }, amount, description }
       
       Query: Get user
       Data: User { name, balance }
       
       Command: Create audit record
       Actor: Dispatcher (payment.created)
       Data: Payment
       Event: auditRecord.created
       
       Command: Calculate balance
       Actor: Dispatcher (payment.created)
       Data: Payment
       Event: user:balanceCalculated

1. Расценки:
    - цены на задачу определяется единоразово, в момент появления в системе (можно с минимальной задержкой)
        - цены рассчитываются без привязки к сотруднику
    - формула, которая говорит сколько списать денег с сотрудника при ассайне задачи — `rand(-10..-20)$`
    
            Command: Charge assign fee
            Actor: task.assigned
            Data: Task
            Event: payment.created
    
    - формула, которая говорит сколько начислить денег сотруднику для выполненой задачи — `rand(20..40)$`
    
            Command: Pay bounty
            Actor: task.completed
            Data: Task
            Event: payment.created
    
    - деньги списываются сразу после ассайна на сотрудника, а начисляются после выполнения задачи.
    - отрицательный баланс переносится на следующий день. Единственный способ его погасить - закрыть достаточное количество задач в течение дня.
2. Дешборд должен выводить количество заработанных топ-менеджментом за сегодня денег.
a) т.е. сумма всех закрытых и заасайненых задач за день с противоположным знаком: `(sum(completed task amount) + sum(assigned task fee)) * -1`

        Query: list top management stats
        Data: TopManagementStats[] { day, amount }
3. В конце дня необходимо:
    
    a) считать сколько денег сотрудник получил за рабочий день
    
    b) отправлять на почту сумму выплаты.
    
        Command: Start day
        Actor: Scheduler
        Data: PaymentDay
        Event: paymentDay.created 
        
        Command: End day
        Actor: Scheduler, UserAccount[role=admin]
        Data: PaymentDay
        Event: paymentDay.ended
        
        Command: Withdraw
        Actor: Dispatcher (paymentDay.ended)
        Data: Task, User
        Event: payment.created 
        
        Command: Withdraw**
        Actor: Dispatcher (payment.created)
        Data: { email, text }
        Event: emal:sent
    
4. После выплаты баланса (в конце дня) он должен обнуляться, и в аудитлоге всех операций аккаунтинга должно быть отображено, что была выплачена сумма.
—
5. Дашборд должен выводить информацию по дням, а не за весь период сразу.
    
    a) вообще хватит только за сегодня (всё равно попуги дальше не помнят), но если чувствуете, что успеете сделать аналитику за каждый день недели — будет круто
    

### **Аналитика**

1. Аналитика — это отдельный дашборд, доступный только админам.
2. Нужно указывать, сколько заработал топ-менеджмент за сегодня и сколько попугов ушло в минус.

        Query: list top management stats
        Data: TopManagementStats[] { day, amount }

        Query: get worker stats
        Data: WorkerStats { negativeBalanceCount }
3. Нужно показывать самую дорогую задачу за день, неделю или месяц.
    
    a) самой дорогой задачей является задача с наивысшей ценой из списка всех закрытых задач за определенный период времени
    
    b) пример того, как это может выглядеть:
    
    03.03 — самая дорогая задача — 28$
    02.03 — самая дорогая задача — 38$
    01.03 — самая дорогая задача — 23$
    01-03 марта — самая дорогая задача — 38$

        Query: list top bounty stats
        Data: TopBountyStats[] { day, Task }